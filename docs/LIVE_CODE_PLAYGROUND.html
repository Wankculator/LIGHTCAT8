<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGB Light Cat - Live Code Playground</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2196f3;
            --secondary: #9c27b0;
            --success: #4caf50;
            --error: #f44336;
            --warning: #ff9800;
            --dark: #1e1e1e;
            --light: #f5f5f5;
            --border: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark);
            color: var(--light);
            height: 100vh;
            overflow: hidden;
        }

        /* Layout */
        .playground {
            display: grid;
            grid-template-rows: 60px 1fr;
            height: 100vh;
        }

        .header {
            background: #2a2a2a;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 20px;
        }

        .main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: var(--border);
        }

        /* Header Elements */
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }

        .btn {
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #1976d2;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--light);
            border: 1px solid #444;
        }

        .btn-secondary:hover {
            background: #333;
        }

        .template-select {
            background: #333;
            color: var(--light);
            border: 1px solid #444;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Editor and Preview Panels */
        .editor-panel, .preview-panel {
            background: var(--dark);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background: #2a2a2a;
            padding: 10px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .panel-title {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 3px;
            background: #333;
        }

        .status-success {
            background: var(--success);
            color: white;
        }

        .status-error {
            background: var(--error);
            color: white;
        }

        .editor-wrapper {
            flex: 1;
            overflow: hidden;
        }

        .CodeMirror {
            height: 100%;
            font-size: 14px;
            line-height: 1.6;
        }

        .preview-wrapper {
            flex: 1;
            padding: 20px;
            overflow: auto;
            background: white;
            color: #333;
        }

        .preview-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        /* Console */
        .console {
            background: #1a1a1a;
            border-top: 1px solid var(--border);
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
        }

        .console-entry {
            margin-bottom: 4px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .console-icon {
            flex-shrink: 0;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
            font-size: 10px;
            font-weight: bold;
        }

        .console-log { color: #888; }
        .console-info .console-icon { background: var(--primary); color: white; }
        .console-warn .console-icon { background: var(--warning); color: white; }
        .console-error .console-icon { background: var(--error); color: white; }

        /* Responsive */
        @media (max-width: 768px) {
            .main {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 1fr;
            }
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1px;
            background: var(--border);
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 10px 20px;
            background: #2a2a2a;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover {
            background: #333;
        }

        .tab.active {
            background: var(--dark);
            color: var(--primary);
        }

        .tab-close {
            margin-left: auto;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
            cursor: pointer;
        }

        .tab-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="playground">
        <header class="header">
            <h1 class="logo">RGB Light Cat Playground</h1>
            
            <select class="template-select" id="templateSelect">
                <option value="">Choose Template...</option>
                <option value="component">React Component</option>
                <option value="game">Game Engine</option>
                <option value="api">API Endpoint</option>
                <option value="state">State Management</option>
                <option value="animation">CSS Animation</option>
                <option value="three">Three.js Scene</option>
            </select>
            
            <div class="controls">
                <button class="btn btn-secondary" id="formatBtn">
                    <span>‚ö°</span> Format
                </button>
                <button class="btn btn-secondary" id="shareBtn">
                    <span>üîó</span> Share
                </button>
                <button class="btn btn-primary" id="runBtn">
                    <span>‚ñ∂</span> Run Code
                </button>
            </div>
        </header>
        
        <main class="main">
            <div class="editor-panel">
                <div class="tabs">
                    <div class="tab active" data-file="index.tsx">
                        <span>üìÑ</span> index.tsx
                    </div>
                    <div class="tab" data-file="styles.css">
                        <span>üé®</span> styles.css
                    </div>
                    <div class="tab" data-file="data.json">
                        <span>üìä</span> data.json
                    </div>
                </div>
                
                <div class="panel-header">
                    <div class="panel-title">
                        <span>üìù</span> Code Editor
                        <span class="status" id="editorStatus">Ready</span>
                    </div>
                </div>
                
                <div class="editor-wrapper">
                    <textarea id="codeEditor"></textarea>
                </div>
            </div>
            
            <div class="preview-panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span>üëÅÔ∏è</span> Live Preview
                        <span class="status" id="previewStatus">Ready</span>
                    </div>
                    <button class="btn btn-secondary" id="refreshBtn">
                        <span>üîÑ</span>
                    </button>
                </div>
                
                <div class="preview-wrapper">
                    <iframe class="preview-frame" id="preview"></iframe>
                </div>
                
                <div class="console" id="console">
                    <div class="console-entry console-info">
                        <span class="console-icon">i</span>
                        <span>Console ready. Output will appear here.</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/jsx/jsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/comment/comment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/keymap/sublime.min.js"></script>

    <script>
        // Code Templates
        const templates = {
            component: `import React, { useState, useEffect } from 'react';

// Interactive RGB Light Cat Component
const RGBLightCat = () => {
  const [color, setColor] = useState('#2196f3');
  const [isAnimating, setIsAnimating] = useState(false);
  const [score, setScore] = useState(0);

  useEffect(() => {
    if (isAnimating) {
      const interval = setInterval(() => {
        const r = Math.floor(Math.random() * 256);
        const g = Math.floor(Math.random() * 256);
        const b = Math.floor(Math.random() * 256);
        setColor(\`rgb(\${r}, \${g}, \${b})\`);
      }, 500);
      return () => clearInterval(interval);
    }
  }, [isAnimating]);

  const handleClick = () => {
    setScore(score + 1);
    console.log('Score:', score + 1);
  };

  return (
    <div style={styles.container}>
      <h1 style={styles.title}>RGB Light Cat Playground</h1>
      
      <div 
        style={{...styles.cat, backgroundColor: color}}
        onClick={handleClick}
      >
        <div style={styles.eyes}>
          <div style={styles.eye}>‚Ä¢</div>
          <div style={styles.eye}>‚Ä¢</div>
        </div>
        <div style={styles.nose}>‚ñº</div>
      </div>
      
      <div style={styles.controls}>
        <button 
          style={styles.button}
          onClick={() => setIsAnimating(!isAnimating)}
        >
          {isAnimating ? '‚è∏ Pause' : '‚ñ∂ Animate'}
        </button>
        
        <input 
          type="color" 
          value={color}
          onChange={(e) => setColor(e.target.value)}
          style={styles.colorPicker}
        />
      </div>
      
      <div style={styles.score}>
        Score: {score} clicks
      </div>
    </div>
  );
};

const styles = {
  container: {
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
    padding: '40px',
    fontFamily: 'Arial, sans-serif',
  },
  title: {
    fontSize: '2.5rem',
    marginBottom: '30px',
    background: 'linear-gradient(45deg, #2196f3, #9c27b0)',
    WebkitBackgroundClip: 'text',
    WebkitTextFillColor: 'transparent',
  },
  cat: {
    width: '200px',
    height: '200px',
    borderRadius: '50% 50% 50% 50% / 60% 60% 40% 40%',
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
    justifyContent: 'center',
    cursor: 'pointer',
    transition: 'all 0.3s ease',
    boxShadow: '0 10px 30px rgba(0,0,0,0.3)',
  },
  eyes: {
    display: 'flex',
    gap: '40px',
    marginBottom: '10px',
  },
  eye: {
    fontSize: '30px',
    color: 'white',
  },
  nose: {
    fontSize: '20px',
    color: 'white',
  },
  controls: {
    display: 'flex',
    gap: '20px',
    marginTop: '30px',
  },
  button: {
    padding: '10px 20px',
    fontSize: '16px',
    borderRadius: '5px',
    border: 'none',
    background: '#2196f3',
    color: 'white',
    cursor: 'pointer',
    transition: 'all 0.3s ease',
  },
  colorPicker: {
    width: '50px',
    height: '40px',
    border: 'none',
    borderRadius: '5px',
    cursor: 'pointer',
  },
  score: {
    marginTop: '20px',
    fontSize: '18px',
    fontWeight: 'bold',
  },
};

// Render the component
ReactDOM.render(<RGBLightCat />, document.getElementById('root'));`,

            game: `// Simple RGB Light Game Engine
class RGBLightGame {
  constructor(canvas) {
    this.canvas = canvas;
    this.ctx = canvas.getContext('2d');
    this.width = 800;
    this.height = 600;
    this.particles = [];
    this.score = 0;
    this.isRunning = false;
    
    this.init();
  }
  
  init() {
    this.canvas.width = this.width;
    this.canvas.height = this.height;
    
    // Create initial particles
    for (let i = 0; i < 20; i++) {
      this.createParticle();
    }
    
    // Event listeners
    this.canvas.addEventListener('click', (e) => this.handleClick(e));
    
    console.log('Game initialized!');
  }
  
  createParticle() {
    const particle = {
      x: Math.random() * this.width,
      y: Math.random() * this.height,
      vx: (Math.random() - 0.5) * 4,
      vy: (Math.random() - 0.5) * 4,
      radius: Math.random() * 20 + 10,
      color: \`rgb(\${Math.floor(Math.random() * 256)}, 
                   \${Math.floor(Math.random() * 256)}, 
                   \${Math.floor(Math.random() * 256)})\`,
      life: 1.0
    };
    this.particles.push(particle);
  }
  
  handleClick(e) {
    const rect = this.canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    // Check if clicked on particle
    for (let i = this.particles.length - 1; i >= 0; i--) {
      const p = this.particles[i];
      const dist = Math.sqrt((x - p.x) ** 2 + (y - p.y) ** 2);
      
      if (dist < p.radius) {
        this.score += Math.floor(p.radius);
        this.particles.splice(i, 1);
        this.createParticle();
        console.log('Score:', this.score);
        break;
      }
    }
  }
  
  update() {
    this.particles.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;
      p.life -= 0.002;
      
      // Bounce off walls
      if (p.x - p.radius < 0 || p.x + p.radius > this.width) {
        p.vx *= -1;
      }
      if (p.y - p.radius < 0 || p.y + p.radius > this.height) {
        p.vy *= -1;
      }
      
      // Respawn dead particles
      if (p.life <= 0) {
        Object.assign(p, {
          x: Math.random() * this.width,
          y: Math.random() * this.height,
          life: 1.0,
          color: \`rgb(\${Math.floor(Math.random() * 256)}, 
                       \${Math.floor(Math.random() * 256)}, 
                       \${Math.floor(Math.random() * 256)})\`
        });
      }
    });
  }
  
  render() {
    // Clear canvas
    this.ctx.fillStyle = '#1a1a1a';
    this.ctx.fillRect(0, 0, this.width, this.height);
    
    // Draw particles
    this.particles.forEach(p => {
      this.ctx.globalAlpha = p.life;
      this.ctx.fillStyle = p.color;
      this.ctx.beginPath();
      this.ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
      this.ctx.fill();
      
      // Glow effect
      const gradient = this.ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.radius * 2);
      gradient.addColorStop(0, p.color);
      gradient.addColorStop(1, 'transparent');
      this.ctx.fillStyle = gradient;
      this.ctx.globalAlpha = p.life * 0.3;
      this.ctx.beginPath();
      this.ctx.arc(p.x, p.y, p.radius * 2, 0, Math.PI * 2);
      this.ctx.fill();
    });
    
    // Reset alpha
    this.ctx.globalAlpha = 1;
    
    // Draw score
    this.ctx.fillStyle = '#fff';
    this.ctx.font = 'bold 24px Arial';
    this.ctx.fillText('Score: ' + this.score, 20, 40);
    
    // Draw instructions
    this.ctx.font = '16px Arial';
    this.ctx.fillText('Click the RGB lights to score!', 20, 70);
  }
  
  start() {
    this.isRunning = true;
    this.gameLoop();
  }
  
  stop() {
    this.isRunning = false;
  }
  
  gameLoop() {
    if (!this.isRunning) return;
    
    this.update();
    this.render();
    
    requestAnimationFrame(() => this.gameLoop());
  }
}

// Create and start the game
const canvas = document.getElementById('gameCanvas');
const game = new RGBLightGame(canvas);
game.start();

// Add to HTML
document.getElementById('root').innerHTML = '<canvas id="gameCanvas" style="border: 2px solid #333; display: block; margin: 20px auto;"></canvas>';`,

            api: `// Mock API Endpoint Implementation
class MockAPI {
  constructor() {
    this.users = [
      { id: 1, name: 'Alice', email: 'alice@example.com', tier: 'gold' },
      { id: 2, name: 'Bob', email: 'bob@example.com', tier: 'silver' },
      { id: 3, name: 'Charlie', email: 'charlie@example.com', tier: 'bronze' }
    ];
    
    this.transactions = [];
    this.setupUI();
  }
  
  // GET /api/users
  async getUsers() {
    console.log('GET /api/users');
    return new Promise(resolve => {
      setTimeout(() => {
        console.log('Response:', this.users);
        resolve({ status: 200, data: this.users });
      }, 500);
    });
  }
  
  // GET /api/users/:id
  async getUserById(id) {
    console.log(\`GET /api/users/\${id}\`);
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        const user = this.users.find(u => u.id === parseInt(id));
        if (user) {
          console.log('Response:', user);
          resolve({ status: 200, data: user });
        } else {
          console.error('User not found');
          reject({ status: 404, error: 'User not found' });
        }
      }, 300);
    });
  }
  
  // POST /api/rgb/invoice
  async createInvoice(data) {
    console.log('POST /api/rgb/invoice', data);
    return new Promise(resolve => {
      setTimeout(() => {
        const invoice = {
          invoiceId: 'inv_' + Date.now(),
          lightningInvoice: 'lnbc' + Math.random().toString(36).substr(2, 9),
          amount: data.batchCount * 2000,
          expiresAt: new Date(Date.now() + 10 * 60 * 1000).toISOString(),
          status: 'pending'
        };
        this.transactions.push(invoice);
        console.log('Response:', invoice);
        resolve({ status: 201, data: invoice });
      }, 800);
    });
  }
  
  // WebSocket simulation
  simulateWebSocket() {
    console.log('WebSocket: Connected to /ws/payments');
    
    setInterval(() => {
      if (this.transactions.length > 0) {
        const randomTx = this.transactions[Math.floor(Math.random() * this.transactions.length)];
        if (randomTx.status === 'pending' && Math.random() > 0.7) {
          randomTx.status = 'paid';
          console.log('WebSocket message:', {
            type: 'payment_update',
            invoiceId: randomTx.invoiceId,
            status: 'paid'
          });
        }
      }
    }, 3000);
  }
  
  setupUI() {
    const html = \`
      <div style="padding: 20px; font-family: Arial, sans-serif;">
        <h2>API Endpoint Tester</h2>
        
        <div style="margin: 20px 0;">
          <h3>Test Endpoints:</h3>
          <button onclick="api.testGetUsers()" style="margin: 5px;">GET /api/users</button>
          <button onclick="api.testGetUser()" style="margin: 5px;">GET /api/users/1</button>
          <button onclick="api.testCreateInvoice()" style="margin: 5px;">POST /api/rgb/invoice</button>
          <button onclick="api.testWebSocket()" style="margin: 5px;">Start WebSocket</button>
        </div>
        
        <div style="margin: 20px 0;">
          <h3>Response:</h3>
          <pre id="response" style="background: #f0f0f0; padding: 10px; border-radius: 5px; min-height: 100px;">
Click a button to test an endpoint...
          </pre>
        </div>
        
        <div style="margin: 20px 0;">
          <h3>Transactions:</h3>
          <div id="transactions" style="background: #f9f9f9; padding: 10px; border-radius: 5px;">
            No transactions yet...
          </div>
        </div>
      </div>
    \`;
    
    document.getElementById('root').innerHTML = html;
  }
  
  async testGetUsers() {
    try {
      const response = await this.getUsers();
      document.getElementById('response').textContent = JSON.stringify(response, null, 2);
    } catch (error) {
      document.getElementById('response').textContent = JSON.stringify(error, null, 2);
    }
  }
  
  async testGetUser() {
    try {
      const response = await this.getUserById(1);
      document.getElementById('response').textContent = JSON.stringify(response, null, 2);
    } catch (error) {
      document.getElementById('response').textContent = JSON.stringify(error, null, 2);
    }
  }
  
  async testCreateInvoice() {
    try {
      const response = await this.createInvoice({
        rgbInvoice: 'rgb:example-invoice',
        batchCount: 5
      });
      document.getElementById('response').textContent = JSON.stringify(response, null, 2);
      this.updateTransactionsList();
    } catch (error) {
      document.getElementById('response').textContent = JSON.stringify(error, null, 2);
    }
  }
  
  testWebSocket() {
    this.simulateWebSocket();
    document.getElementById('response').textContent = 'WebSocket simulation started. Check console for messages.';
  }
  
  updateTransactionsList() {
    const txDiv = document.getElementById('transactions');
    if (this.transactions.length === 0) {
      txDiv.innerHTML = 'No transactions yet...';
      return;
    }
    
    txDiv.innerHTML = this.transactions.map(tx => \`
      <div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">
        <strong>\${tx.invoiceId}</strong> - 
        <span style="color: \${tx.status === 'paid' ? 'green' : 'orange'};">\${tx.status}</span> - 
        \${tx.amount} sats
      </div>
    \`).join('');
  }
}

// Initialize API
const api = new MockAPI();
window.api = api; // Make it globally accessible`,

            state: `// State Management with Time Travel
class StateManager {
  constructor() {
    this.state = {
      user: null,
      theme: 'light',
      counter: 0,
      todos: []
    };
    this.history = [JSON.parse(JSON.stringify(this.state))];
    this.historyIndex = 0;
    this.subscribers = [];
    this.setupUI();
  }
  
  // Get current state
  getState() {
    return this.state;
  }
  
  // Update state
  setState(updates) {
    const prevState = JSON.parse(JSON.stringify(this.state));
    this.state = { ...this.state, ...updates };
    
    // Add to history
    this.history = this.history.slice(0, this.historyIndex + 1);
    this.history.push(JSON.parse(JSON.stringify(this.state)));
    this.historyIndex++;
    
    // Notify subscribers
    this.notify();
    
    console.log('State updated:', {
      prev: prevState,
      current: this.state,
      action: updates
    });
  }
  
  // Subscribe to state changes
  subscribe(callback) {
    this.subscribers.push(callback);
    return () => {
      this.subscribers = this.subscribers.filter(cb => cb !== callback);
    };
  }
  
  // Notify all subscribers
  notify() {
    this.subscribers.forEach(callback => callback(this.state));
    this.render();
  }
  
  // Time travel
  undo() {
    if (this.historyIndex > 0) {
      this.historyIndex--;
      this.state = JSON.parse(JSON.stringify(this.history[this.historyIndex]));
      this.notify();
      console.log('Undo to index:', this.historyIndex);
    }
  }
  
  redo() {
    if (this.historyIndex < this.history.length - 1) {
      this.historyIndex++;
      this.state = JSON.parse(JSON.stringify(this.history[this.historyIndex]));
      this.notify();
      console.log('Redo to index:', this.historyIndex);
    }
  }
  
  // Actions
  login(user) {
    this.setState({ user });
  }
  
  logout() {
    this.setState({ user: null });
  }
  
  toggleTheme() {
    this.setState({ theme: this.state.theme === 'light' ? 'dark' : 'light' });
  }
  
  increment() {
    this.setState({ counter: this.state.counter + 1 });
  }
  
  decrement() {
    this.setState({ counter: this.state.counter - 1 });
  }
  
  addTodo(text) {
    const todo = {
      id: Date.now(),
      text,
      completed: false
    };
    this.setState({ todos: [...this.state.todos, todo] });
  }
  
  toggleTodo(id) {
    const todos = this.state.todos.map(todo =>
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    );
    this.setState({ todos });
  }
  
  deleteTodo(id) {
    const todos = this.state.todos.filter(todo => todo.id !== id);
    this.setState({ todos });
  }
  
  // UI Setup
  setupUI() {
    document.getElementById('root').innerHTML = \`
      <div style="padding: 20px; font-family: Arial, sans-serif;">
        <h2>State Management Demo</h2>
        
        <div style="display: flex; gap: 20px; margin: 20px 0;">
          <button onclick="store.undo()" id="undoBtn">‚Ü∂ Undo</button>
          <button onclick="store.redo()" id="redoBtn">‚Ü∑ Redo</button>
          <span>History: <span id="historyInfo">1/1</span></span>
        </div>
        
        <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0;">
          <h3>Current State:</h3>
          <pre id="stateDisplay"></pre>
        </div>
        
        <div style="margin: 20px 0;">
          <h3>Actions:</h3>
          <div style="margin: 10px 0;">
            <button onclick="store.login({id: 1, name: 'John Doe'})">Login</button>
            <button onclick="store.logout()">Logout</button>
            <button onclick="store.toggleTheme()">Toggle Theme</button>
          </div>
          
          <div style="margin: 10px 0;">
            <button onclick="store.decrement()">-</button>
            <span id="counter" style="margin: 0 10px; font-size: 20px;">0</span>
            <button onclick="store.increment()">+</button>
          </div>
          
          <div style="margin: 10px 0;">
            <input type="text" id="todoInput" placeholder="Add todo..." style="padding: 5px;">
            <button onclick="addTodoFromInput()">Add Todo</button>
          </div>
          
          <div id="todoList" style="margin: 10px 0;"></div>
        </div>
        
        <div style="margin: 20px 0;">
          <h3>State History:</h3>
          <div id="historyList" style="max-height: 200px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 5px;"></div>
        </div>
      </div>
    \`;
    
    this.render();
  }
  
  render() {
    // Update state display
    document.getElementById('stateDisplay').textContent = JSON.stringify(this.state, null, 2);
    
    // Update history info
    document.getElementById('historyInfo').textContent = \`\${this.historyIndex + 1}/\${this.history.length}\`;
    
    // Update undo/redo buttons
    document.getElementById('undoBtn').disabled = this.historyIndex === 0;
    document.getElementById('redoBtn').disabled = this.historyIndex === this.history.length - 1;
    
    // Update counter
    document.getElementById('counter').textContent = this.state.counter;
    
    // Update theme
    document.body.style.background = this.state.theme === 'dark' ? '#333' : '#fff';
    document.body.style.color = this.state.theme === 'dark' ? '#fff' : '#333';
    
    // Update todo list
    const todoList = document.getElementById('todoList');
    todoList.innerHTML = this.state.todos.map(todo => \`
      <div style="margin: 5px 0;">
        <input type="checkbox" \${todo.completed ? 'checked' : ''} 
               onchange="store.toggleTodo(\${todo.id})">
        <span style="text-decoration: \${todo.completed ? 'line-through' : 'none'};">
          \${todo.text}
        </span>
        <button onclick="store.deleteTodo(\${todo.id})" style="margin-left: 10px;">√ó</button>
      </div>
    \`).join('');
    
    // Update history list
    const historyList = document.getElementById('historyList');
    historyList.innerHTML = this.history.map((state, index) => \`
      <div style="margin: 5px 0; padding: 5px; background: \${index === this.historyIndex ? '#e0e0e0' : 'white'}; border-radius: 3px; cursor: pointer;"
           onclick="store.goToHistory(\${index})">
        <strong>State #\${index + 1}</strong>
        <pre style="margin: 5px 0; font-size: 12px;">\${JSON.stringify(state, null, 2)}</pre>
      </div>
    \`).join('');
  }
  
  goToHistory(index) {
    this.historyIndex = index;
    this.state = JSON.parse(JSON.stringify(this.history[index]));
    this.notify();
  }
}

// Helper function
function addTodoFromInput() {
  const input = document.getElementById('todoInput');
  if (input.value.trim()) {
    store.addTodo(input.value.trim());
    input.value = '';
  }
}

// Initialize store
const store = new StateManager();
window.store = store; // Make it globally accessible

// Subscribe to changes
store.subscribe(state => {
  console.log('State changed:', state);
});`,

            animation: `// CSS Animation Showcase
const animationStyles = \`
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
    }
    
    .container {
      text-align: center;
      padding: 40px;
    }
    
    h1 {
      color: white;
      margin-bottom: 40px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .animation-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .animation-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    /* Pulse Animation */
    .pulse {
      width: 80px;
      height: 80px;
      background: #667eea;
      border-radius: 50%;
      margin: 20px auto;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
      }
      70% {
        transform: scale(1.1);
        box-shadow: 0 0 0 20px rgba(102, 126, 234, 0);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
      }
    }
    
    /* Rotate Animation */
    .rotate {
      width: 80px;
      height: 80px;
      background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
      margin: 20px auto;
      animation: rotate 3s linear infinite;
    }
    
    @keyframes rotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }
    
    /* Bounce Animation */
    .bounce {
      width: 80px;
      height: 80px;
      background: #4facfe;
      border-radius: 50%;
      margin: 20px auto;
      animation: bounce 2s ease-in-out infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-30px);
      }
      60% {
        transform: translateY(-15px);
      }
    }
    
    /* Slide Animation */
    .slide {
      width: 80px;
      height: 80px;
      background: #fa709a;
      margin: 20px auto;
      animation: slide 2s ease-in-out infinite alternate;
    }
    
    @keyframes slide {
      from {
        transform: translateX(-30px);
      }
      to {
        transform: translateX(30px);
      }
    }
    
    /* RGB Color Animation */
    .rgb-color {
      width: 80px;
      height: 80px;
      margin: 20px auto;
      border-radius: 10px;
      animation: rgbColor 3s ease-in-out infinite;
    }
    
    @keyframes rgbColor {
      0% {
        background: rgb(255, 0, 0);
        transform: scale(1);
      }
      33% {
        background: rgb(0, 255, 0);
        transform: scale(1.1);
      }
      66% {
        background: rgb(0, 0, 255);
        transform: scale(1);
      }
      100% {
        background: rgb(255, 0, 0);
        transform: scale(1);
      }
    }
    
    /* Loading Spinner */
    .spinner {
      width: 80px;
      height: 80px;
      margin: 20px auto;
      border: 8px solid #f3f3f3;
      border-top: 8px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Morphing Shape */
    .morph {
      width: 80px;
      height: 80px;
      background: #ff6b6b;
      margin: 20px auto;
      animation: morph 4s ease-in-out infinite;
    }
    
    @keyframes morph {
      0% {
        border-radius: 0;
        transform: rotate(0deg);
      }
      25% {
        border-radius: 50%;
        transform: rotate(90deg);
      }
      50% {
        border-radius: 0 50%;
        transform: rotate(180deg);
      }
      75% {
        border-radius: 50% 0;
        transform: rotate(270deg);
      }
      100% {
        border-radius: 0;
        transform: rotate(360deg);
      }
    }
    
    /* Glow Effect */
    .glow {
      width: 80px;
      height: 80px;
      background: #fff;
      border-radius: 50%;
      margin: 20px auto;
      animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
      from {
        box-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #e60073;
      }
      to {
        box-shadow: 0 0 20px #fff, 0 0 30px #ff4da6, 0 0 40px #ff4da6;
      }
    }
    
    .animation-card h3 {
      margin-top: 10px;
      color: #333;
    }
  </style>
\`;

document.getElementById('root').innerHTML = animationStyles + \`
  <div class="container">
    <h1>CSS Animation Showcase</h1>
    <div class="animation-grid">
      <div class="animation-card">
        <div class="pulse"></div>
        <h3>Pulse</h3>
      </div>
      
      <div class="animation-card">
        <div class="rotate"></div>
        <h3>Rotate</h3>
      </div>
      
      <div class="animation-card">
        <div class="bounce"></div>
        <h3>Bounce</h3>
      </div>
      
      <div class="animation-card">
        <div class="slide"></div>
        <h3>Slide</h3>
      </div>
      
      <div class="animation-card">
        <div class="rgb-color"></div>
        <h3>RGB Color</h3>
      </div>
      
      <div class="animation-card">
        <div class="spinner"></div>
        <h3>Spinner</h3>
      </div>
      
      <div class="animation-card">
        <div class="morph"></div>
        <h3>Morph</h3>
      </div>
      
      <div class="animation-card">
        <div class="glow"></div>
        <h3>Glow</h3>
      </div>
    </div>
  </div>
\`;`,

            three: `// Three.js RGB Light Scene
import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

class RGBLightScene {
  constructor() {
    this.scene = new THREE.Scene();
    this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    this.renderer = new THREE.WebGLRenderer({ antialias: true });
    this.lights = [];
    this.time = 0;
    
    this.init();
  }
  
  init() {
    // Setup renderer
    this.renderer.setSize(window.innerWidth, window.innerHeight);
    this.renderer.shadowMap.enabled = true;
    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.getElementById('root').appendChild(this.renderer.domElement);
    
    // Setup camera
    this.camera.position.set(0, 10, 20);
    this.camera.lookAt(0, 0, 0);
    
    // Add ambient light
    const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
    this.scene.add(ambientLight);
    
    // Add ground
    const groundGeometry = new THREE.PlaneGeometry(50, 50);
    const groundMaterial = new THREE.MeshStandardMaterial({ 
      color: 0x222222,
      roughness: 0.8,
      metalness: 0.2
    });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    this.scene.add(ground);
    
    // Create RGB lights
    this.createRGBLights();
    
    // Create central object
    this.createCentralObject();
    
    // Handle resize
    window.addEventListener('resize', () => this.onResize());
    
    // Start animation
    this.animate();
    
    console.log('Three.js scene initialized!');
  }
  
  createRGBLights() {
    const colors = [0xff0000, 0x00ff00, 0x0000ff];
    const positions = [
      { x: -10, y: 5, z: 0 },
      { x: 10, y: 5, z: 0 },
      { x: 0, y: 5, z: -10 }
    ];
    
    colors.forEach((color, i) => {
      // Create light
      const light = new THREE.PointLight(color, 2, 30);
      light.position.set(positions[i].x, positions[i].y, positions[i].z);
      light.castShadow = true;
      light.shadow.mapSize.width = 1024;
      light.shadow.mapSize.height = 1024;
      this.scene.add(light);
      
      // Create light sphere
      const sphereGeometry = new THREE.SphereGeometry(0.5, 32, 32);
      const sphereMaterial = new THREE.MeshBasicMaterial({ 
        color: color,
        emissive: color,
        emissiveIntensity: 1
      });
      const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
      sphere.position.copy(light.position);
      this.scene.add(sphere);
      
      this.lights.push({ light, sphere, basePosition: {...positions[i]} });
    });
  }
  
  createCentralObject() {
    // Create cat-like shape with cubes
    const group = new THREE.Group();
    
    // Body
    const bodyGeometry = new THREE.BoxGeometry(4, 3, 4);
    const bodyMaterial = new THREE.MeshStandardMaterial({ 
      color: 0x666666,
      roughness: 0.5,
      metalness: 0.3
    });
    const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
    body.castShadow = true;
    body.receiveShadow = true;
    group.add(body);
    
    // Head
    const headGeometry = new THREE.BoxGeometry(3, 2.5, 3);
    const head = new THREE.Mesh(headGeometry, bodyMaterial);
    head.position.y = 2.5;
    head.castShadow = true;
    head.receiveShadow = true;
    group.add(head);
    
    // Ears
    const earGeometry = new THREE.ConeGeometry(0.8, 1.5, 3);
    const leftEar = new THREE.Mesh(earGeometry, bodyMaterial);
    leftEar.position.set(-1, 4, 0);
    leftEar.castShadow = true;
    group.add(leftEar);
    
    const rightEar = new THREE.Mesh(earGeometry, bodyMaterial);
    rightEar.position.set(1, 4, 0);
    rightEar.castShadow = true;
    group.add(rightEar);
    
    // Eyes (emissive)
    const eyeGeometry = new THREE.SphereGeometry(0.3, 16, 16);
    const eyeMaterial = new THREE.MeshBasicMaterial({ 
      color: 0xffffff,
      emissive: 0xffffff,
      emissiveIntensity: 1
    });
    
    const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
    leftEye.position.set(-0.7, 2.5, 1.3);
    group.add(leftEye);
    
    const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
    rightEye.position.set(0.7, 2.5, 1.3);
    group.add(rightEye);
    
    group.position.y = 1.5;
    this.centralObject = group;
    this.scene.add(group);
  }
  
  animate() {
    requestAnimationFrame(() => this.animate());
    
    this.time += 0.01;
    
    // Animate lights
    this.lights.forEach((lightObj, i) => {
      const angle = this.time + (i * Math.PI * 2 / 3);
      lightObj.light.position.x = lightObj.basePosition.x + Math.sin(angle) * 5;
      lightObj.light.position.z = lightObj.basePosition.z + Math.cos(angle) * 5;
      lightObj.light.position.y = lightObj.basePosition.y + Math.sin(angle * 2) * 2;
      
      lightObj.sphere.position.copy(lightObj.light.position);
      
      // Pulse light intensity
      lightObj.light.intensity = 2 + Math.sin(this.time * 3 + i) * 0.5;
    });
    
    // Rotate central object
    if (this.centralObject) {
      this.centralObject.rotation.y = Math.sin(this.time) * 0.3;
      this.centralObject.position.y = 1.5 + Math.sin(this.time * 2) * 0.5;
    }
    
    // Orbit camera
    this.camera.position.x = Math.sin(this.time * 0.5) * 20;
    this.camera.position.z = Math.cos(this.time * 0.5) * 20;
    this.camera.lookAt(0, 0, 0);
    
    this.renderer.render(this.scene, this.camera);
  }
  
  onResize() {
    this.camera.aspect = window.innerWidth / window.innerHeight;
    this.camera.updateProjectionMatrix();
    this.renderer.setSize(window.innerWidth, window.innerHeight);
  }
}

// Initialize scene
new RGBLightScene();

// Add control info
const info = document.createElement('div');
info.style.cssText = 'position: absolute; top: 10px; left: 10px; color: white; font-family: Arial; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px;';
info.innerHTML = '<h3>RGB Light Three.js Scene</h3><p>Watch the RGB lights orbit around the cat!</p>';
document.body.appendChild(info);`
        };

        // Initialize CodeMirror
        const editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
            mode: 'jsx',
            theme: 'monokai',
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            keyMap: 'sublime',
            extraKeys: {
                'Cmd-/': 'toggleComment',
                'Ctrl-/': 'toggleComment'
            }
        });

        // Set initial template
        editor.setValue(templates.component);

        // Template selector
        document.getElementById('templateSelect').addEventListener('change', (e) => {
            const template = templates[e.target.value];
            if (template) {
                editor.setValue(template);
                runCode();
            }
        });

        // Run button
        document.getElementById('runBtn').addEventListener('click', runCode);

        // Format button
        document.getElementById('formatBtn').addEventListener('click', () => {
            // Simple formatting (in real app, use prettier)
            const code = editor.getValue();
            try {
                // Basic formatting
                const formatted = code
                    .replace(/;(\s*})/g, ';\n$1')
                    .replace(/{\s*/g, '{\n  ')
                    .replace(/}\s*/g, '\n}\n');
                editor.setValue(formatted);
            } catch (e) {
                console.error('Format error:', e);
            }
        });

        // Share button
        document.getElementById('shareBtn').addEventListener('click', () => {
            const code = editor.getValue();
            const encoded = btoa(encodeURIComponent(code));
            const url = window.location.origin + window.location.pathname + '#code=' + encoded;
            navigator.clipboard.writeText(url);
            
            updateStatus('editorStatus', 'Link copied!', 'success');
            setTimeout(() => updateStatus('editorStatus', 'Ready'), 2000);
        });

        // Auto-run on code change (debounced)
        let runTimeout;
        editor.on('change', () => {
            clearTimeout(runTimeout);
            runTimeout = setTimeout(runCode, 1000);
        });

        // Console logging
        function addConsoleEntry(type, ...args) {
            const console = document.getElementById('console');
            const entry = document.createElement('div');
            entry.className = `console-entry console-${type}`;
            
            const icon = document.createElement('span');
            icon.className = 'console-icon';
            icon.textContent = type === 'error' ? '‚úï' : type === 'warn' ? '!' : type === 'info' ? 'i' : '‚Ä∫';
            
            const message = document.createElement('span');
            message.textContent = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            entry.appendChild(icon);
            entry.appendChild(message);
            console.appendChild(entry);
            
            // Auto-scroll
            console.scrollTop = console.scrollHeight;
        }

        // Run code function
        function runCode() {
            updateStatus('previewStatus', 'Running...', 'info');
            
            const code = editor.getValue();
            const preview = document.getElementById('preview');
            
            // Clear console
            document.getElementById('console').innerHTML = '';
            
            try {
                // Create preview content
                const html = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <style>
                            body { 
                                margin: 0; 
                                padding: 0; 
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            }
                            #root { 
                                min-height: 100vh; 
                                display: flex; 
                                align-items: center; 
                                justify-content: center;
                            }
                        </style>
                        <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
                        <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
                        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
                    </head>
                    <body>
                        <div id="root"></div>
                        <script type="text/babel">
                            // Override console methods
                            const originalConsole = { ...console };
                            console.log = (...args) => {
                                parent.postMessage({ type: 'console', level: 'log', args }, '*');
                                originalConsole.log(...args);
                            };
                            console.info = (...args) => {
                                parent.postMessage({ type: 'console', level: 'info', args }, '*');
                                originalConsole.info(...args);
                            };
                            console.warn = (...args) => {
                                parent.postMessage({ type: 'console', level: 'warn', args }, '*');
                                originalConsole.warn(...args);
                            };
                            console.error = (...args) => {
                                parent.postMessage({ type: 'console', level: 'error', args }, '*');
                                originalConsole.error(...args);
                            };

                            try {
                                ${code}
                            } catch (error) {
                                console.error('Runtime error:', error.message);
                                document.getElementById('root').innerHTML = '<div style="color: red; padding: 20px;"><h3>Error:</h3><pre>' + error.stack + '</pre></div>';
                            }
                        </script>
                    </body>
                    </html>
                `;
                
                // Update preview
                preview.srcdoc = html;
                
                updateStatus('previewStatus', 'Running', 'success');
                
            } catch (error) {
                console.error('Execution error:', error);
                addConsoleEntry('error', 'Execution error:', error.message);
                updateStatus('previewStatus', 'Error', 'error');
            }
        }

        // Listen for console messages from iframe
        window.addEventListener('message', (e) => {
            if (e.data.type === 'console') {
                addConsoleEntry(e.data.level, ...e.data.args);
            }
        });

        // Status update helper
        function updateStatus(elementId, text, type = '') {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = 'status' + (type ? ` status-${type}` : '');
        }

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelector('.tab.active')?.classList.remove('active');
                tab.classList.add('active');
                // In real app, switch between different files
            });
        });

        // Load from URL hash
        if (window.location.hash.startsWith('#code=')) {
            try {
                const encoded = window.location.hash.slice(6);
                const code = decodeURIComponent(atob(encoded));
                editor.setValue(code);
            } catch (e) {
                console.error('Failed to load shared code:', e);
            }
        }

        // Initial run
        runCode();
    </script>
</body>
</html>